<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æ¸¸æˆç²¾å½©</title>
<link rel="icon" href="data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ctext y='50%25' x='50%25' dominant-baseline='middle' text-anchor='middle' font-size='50'%3Eâœ¨%3C/text%3E%3C/svg%3E">
<style>
  :root{
    --fg: #fff;
    --glass: rgba(255,255,255,0.12);
    --glass-strong: rgba(0,0,0,0.35);
    --gap: 24px;
  }

  /* åŸºç¡€ */
  html,body{height:100%;margin:0}
  body{
    font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background-image: url("background.jpg");
    background-size: cover;
    background-position: center;
    color:var(--fg);
    padding:40px;
    box-sizing:border-box;
    text-align:center;
  }

  h1{font-size:40px;margin:0 0 24px}

  main{max-width:1200px;margin:0 auto}

  /* å®¹å™¨ */
  .container{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap:var(--gap);
    padding:20px 0;
  }

  /* å¡ç‰‡/è§†é¢‘ */
  .video-box{
    background: var(--glass);
    border-radius:12px;
    overflow:hidden;
    backdrop-filter: blur(6px);
    transition: transform .28s ease, box-shadow .28s ease;
    position:relative;
    cursor:pointer;
    display:flex;
    flex-direction:column;
    align-items:stretch;
  }
  .video-box:focus{outline:3px solid rgba(255,255,255,0.12); box-shadow:0 6px 30px rgba(0,0,0,0.45)}
  .video-box:hover{ transform: translateY(-6px) scale(1.02); box-shadow:0 14px 50px rgba(0,0,0,0.45) }

  /* è®©è§†é¢‘å¡«å……ç›’å­å¹¶ä¿æŒè£åˆ‡ */
  .video-box video{
    width:100%;
    height:100%;
    display:block;
    object-fit:cover;
    aspect-ratio: 16/9;
    background: #000;
  }

  .meta{
    padding:10px;
    font-size:15px;
    background: linear-gradient(180deg, rgba(0,0,0,0.15), rgba(0,0,0,0.35));
    text-align:left;
  }

  .title{ font-weight:600 }
  .caption{ font-size:13px; opacity:0.85 }

  /* play overlay (for accessibility/visual) */
  .play-overlay{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none; /* click goes to container */
    transition:opacity .18s ease;
  }
  .play-pulse{
    width:72px;height:72px;border-radius:50%;
    display:grid;place-items:center;
    background:rgba(0,0,0,0.35);backdrop-filter:blur(2px);
  }

  /* å‡å°‘åŠ¨ç”»å¯¹æ•æ„Ÿç”¨æˆ·å½±å“ */
  @media (prefers-reduced-motion: reduce){
    .video-box, .play-overlay, .video-box:hover { transition: none; transform:none; }
  }

  /* å“åº”å¼å°å±ä¿æŒå¯è¯» */
  @media (max-width:420px){
    body{padding:18px}
    h1{font-size:24px}
  }
</style>
</head>
<body>
<main>
  <h1>ğŸ® æ¸¸æˆç²¾å½©</h1>
  <section class="container" id="gallery" aria-label="è§†é¢‘ç”»å»Š">
    <!-- æ¯ä¸ªè§†é¢‘ç”¨ figure/figcaption è¯­ä¹‰åŒ– -->
    <figure class="video-box" tabindex="0" role="group" aria-label="è¶…ç³–è§†é¢‘">
      <!-- NOTE: data-src ç”¨äºæ‡’åŠ è½½ï¼Œå®é™…è¿›å…¥è§†å£æ—¶ä¼šæ³¨å…¥ä¸º <source> -->
      <video muted playsinline preload="none" loop data-preview="true" aria-hidden="false">
        <!-- <source> ä¼šç”±è„šæœ¬åœ¨éœ€è¦æ—¶æ³¨å…¥ä»¥å®ç°æ‡’åŠ è½½ -->
        <track kind="captions" srclang="zh" label="ä¸­æ–‡å­—å¹•" default>
      </video>
      <div class="play-overlay" aria-hidden="true">
        <div class="play-pulse">â–¶</div>
      </div>
      <figcaption class="meta">
        <div class="title">è¶…ç³–è§†é¢‘</div>
        <div class="caption">ç²¾å½©ç¬é—´å‰ªè¾‘ Â· 00:30</div>
      </figcaption>
      <!-- data å±æ€§ä¿å­˜å®é™…èµ„æºåœ°å€ä»¥ä¾›è„šæœ¬æ³¨å…¥ -->
      <script type="application/json" data-video-src>
        {"sources":[{"src":"video1.mp4","type":"video/mp4"}],"poster":"cover.jpg"}
      </script>
    </figure>

    <figure class="video-box" tabindex="0" role="group" aria-label="ä¸‹å®šå†³å¿ƒ">
      <video muted playsinline preload="none" loop data-preview="true" aria-hidden="false"></video>
      <div class="play-overlay" aria-hidden="true"><div class="play-pulse">â–¶</div></div>
      <figcaption class="meta"><div class="title">ä¸‹å®šå†³å¿ƒ</div><div class="caption">é«˜èƒ½ç‰‡æ®µ Â· 00:45</div></figcaption>
      <script type="application/json" data-video-src>
        {"sources":[{"src":"video2.mp4","type":"video/mp4"}],"poster":"cover.jpg"}
      </script>
    </figure>

    <figure class="video-box" tabindex="0" role="group" aria-label="è·‘é…·è¾¾äºº">
      <video muted playsinline preload="none" loop data-preview="true" aria-hidden="false"></video>
      <div class="play-overlay" aria-hidden="true"><div class="play-pulse">â–¶</div></div>
      <figcaption class="meta"><div class="title">è·‘é…·è¾¾äºº</div><div class="caption">é€Ÿåº¦ä¸æ“ä½œ Â· 01:12</div></figcaption>
      <script type="application/json" data-video-src>
        {"sources":[{"src":"video3.mp4","type":"video/mp4"}],"poster":"cover.jpg"}
      </script>
    </figure>

    <figure class="video-box" tabindex="0" role="group" aria-label="æ‘åº„æ¶é­”">
      <video muted playsinline preload="none" loop data-preview="true" aria-hidden="false"></video>
      <div class="play-overlay" aria-hidden="true"><div class="play-pulse">â–¶</div></div>
      <figcaption class="meta"><div class="title">æ‘åº„æ¶é­”</div><div class="caption">æƒŠæ‚šå‰ªè¾‘ Â· 00:22</div></figcaption>
      <script type="application/json" data-video-src>
        {"sources":[{"src":"video4.mp4","type":"video/mp4"}],"poster":"cover.jpg"}
      </script>
    </figure>
  </section>
</main>

<script>
/*
  åŠŸèƒ½è¯´æ˜ï¼š
  - ä½¿ç”¨ IntersectionObserver æ‡’åŠ è½½ <source>ï¼ˆè¿›å…¥è§†å£æ—¶æ³¨å…¥ï¼‰
  - pointerenter å»¶è¿Ÿæ’­æ”¾ previewï¼ˆ1sï¼‰ï¼Œpointerleave åœæ­¢
  - click æˆ–é”®ç›˜ ç©ºæ ¼/Enter åˆ‡æ¢æ’­æ”¾çŠ¶æ€ï¼ˆä¿æŒé™éŸ³/éé¢„è§ˆæ—¶å¯ä»¥æ‰“å¼€å£°éŸ³ï¼‰
  - é¢„è§ˆæ—¶ä¿æŒ loop å’Œ mutedï¼Œç‚¹å‡»åç”¨æˆ·å¯æ”¾å¼€é™éŸ³ï¼ˆæµè§ˆå™¨ä¼šé˜»æ­¢è‡ªåŠ¨æœ‰å£°æ’­æ”¾ï¼‰
*/

(function(){
  const GALLERY = document.getElementById('gallery');
  const PREVIEW_DELAY = 1000; // ms
  let hoverTimers = new WeakMap();

  // æŠŠ script[data-video-src] çš„ json æ³¨å…¥åˆ°å®¹å™¨å…ƒç´ ï¼Œæ–¹ä¾¿åç»­è¯»å–
  function attachMeta(figure){
    const s = figure.querySelector('script[data-video-src]');
    if(!s) return;
    try{
      figure._meta = JSON.parse(s.textContent);
    }catch(e){
      figure._meta = null;
    }
    // set poster on video element so poster shows before sources loaded
    const vid = figure.querySelector('video');
    if(figure._meta && figure._meta.poster){
      vid.setAttribute('poster', figure._meta.poster);
    }
  }

  // ä¸ºæ‰€æœ‰ video-box é¢„å…ˆ attach meta
  document.querySelectorAll('.video-box').forEach(attachMeta);

  // æ‡’åŠ è½½ï¼šå½“å…ƒç´ å¯è§æ—¶æ³¨å…¥ <source>ï¼ˆå¦‚æœè¿˜æ²¡æ³¨å…¥è¿‡ï¼‰
  const io = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const fig = entry.target;
        const vid = fig.querySelector('video');
        if(!vid.dataset.srcLoaded){
          const meta = fig._meta;
          if(meta && Array.isArray(meta.sources)){
            meta.sources.forEach(srcObj => {
              const source = document.createElement('source');
              source.src = srcObj.src;
              if(srcObj.type) source.type = srcObj.type;
              vid.appendChild(source);
            });
            vid.dataset.srcLoaded = "1";
            // ä»…åŠ è½½ metadataï¼ˆæµè§ˆå™¨ä¼šæŒ‰ preload=none ä¿æŒä¸ä¸‹è½½åª’ä½“æ•°æ®ç›´åˆ°éœ€è¦ï¼‰
            vid.load();
          }
        }
      }
    });
  }, { rootMargin: '200px' });

  document.querySelectorAll('.video-box').forEach(f => io.observe(f));

  // äº‹ä»¶å§”æ‰˜å¤„ç†: pointerenter / pointerleave / click / keyboard
  GALLERY.addEventListener('pointerenter', onPointerEnter, true);
  GALLERY.addEventListener('pointerleave', onPointerLeave, true);
  GALLERY.addEventListener('click', onClick, true);
  GALLERY.addEventListener('keydown', onKeydown, true);

  function onPointerEnter(e){
    const fig = e.target.closest('.video-box');
    if(!fig) return;
    const vid = fig.querySelector('video');
    // delay 1s then play preview (if still hovered)
    clearHoverTimer(fig);
    const t = setTimeout(() => {
      // ensure video has sources loaded
      if(!vid.dataset.srcLoaded){
        // try forcing load (IO should have loaded it earlier, but double-check)
        const meta = fig._meta;
        if(meta && Array.isArray(meta.sources)){
          meta.sources.forEach(srcObj => {
            const source = document.createElement('source');
            source.src = srcObj.src;
            if(srcObj.type) source.type = srcObj.type;
            vid.appendChild(source);
          });
          vid.dataset.srcLoaded = "1";
          vid.load();
        }
      }
      // Only play preview when paused
      vid.muted = true;
      vid.loop = true;
      // try/catch in case play() is rejected
      vid.play().catch(()=>{ /* ignore */ });
    }, PREVIEW_DELAY);
    hoverTimers.set(fig, t);
  }

  function onPointerLeave(e){
    const fig = e.target.closest('.video-box');
    if(!fig) return;
    const vid = fig.querySelector('video');
    clearHoverTimer(fig);
    // stop preview only if it is playing and is muted (i.e., a preview)
    if(!vid.paused && vid.muted){
      vid.pause();
      vid.currentTime = 0;
    }
  }

  function clearHoverTimer(fig){
    const t = hoverTimers.get(fig);
    if(t) { clearTimeout(t); hoverTimers.delete(fig); }
  }

  function onClick(e){
    const fig = e.target.closest('.video-box');
    if(!fig) return;
    const vid = fig.querySelector('video');
    // Toggle play/pause. When user explicitly clicks, unmute to allow sound if allowed later.
    if(vid.paused){
      // user-initiated play: try to unmute (browsers may block autoplay with sound; user click counts)
      vid.muted = false;
      vid.loop = false; // normal playback probably shouldn't loop
      vid.play().catch(()=>{ /* ignore */ });
    } else {
      vid.pause();
    }
  }

  function onKeydown(e){
    const fig = e.target.closest('.video-box');
    if(!fig) return;
    if(e.code === 'Space' || e.key === ' ' || e.key === 'Enter'){
      e.preventDefault();
      const vid = fig.querySelector('video');
      if(vid.paused){
        vid.muted = false;
        vid.loop = false;
        vid.play().catch(()=>{});
      } else {
        vid.pause();
      }
    }
  }

  // æ¸…ç†ï¼šåœ¨é¡µé¢å¸è½½æ—¶æ¸…æ‰ timers / observersï¼ˆè‰¯å¥½ä¹ æƒ¯ï¼‰
  window.addEventListener('beforeunload', () => {
    hoverTimers = new WeakMap();
    io.disconnect();
  });
})();
</script>
</body>
</html>
